#cloud-config
users:
  - default
  - name: ocarun
    sudo: ALL=(ALL) NOPASSWD:ALL

runcmd:
  - echo "ocarun ALL=(ALL) NOPASSWD:ALL" > /tmp/101-oracle-cloud-agent-run-command
  - cp /tmp/101-oracle-cloud-agent-run-command /etc/sudoers.d/
  - yum -y install mysql
  - sleep 10
  - export OCI_CLI_AUTH=instance_principal
  - python3 -m pip install --user oci-cli
  - sleep 10
  - ~/.local/bin/oci artifacts generic artifact download-by-path --repository-id ${ARTIFACT_REPO_OCID} --artifact-path ${ARTIFACT_REPO_OCID} --artifact-version ${ARTIFACT_VERSION} --file /tmp/script.sql
  - mysql --password=${DB_PASSWORD} --user=${DB_USERNAME} --port=${DB_PORT} --host=${DB_SERVER} </tmp/script.sql
  - sleep 10